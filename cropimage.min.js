/** ---------------------------------------------------------------------------
	*											CropImage Plugin with JQuery
	* ---------------------------------------------------------------------------
	* Version: 1.0.0
	* Author: Fabrice K.E.M
	* Created: 10/06/2018
	* Repository: https://github.com/fabrice8/cropimage
	*/
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}((function(t){"use strict";var i={black:"rgba(20, 20, 20, .6)",white:"rgba(250, 250, 250, .6)"},e=!1,h=!1;if(void 0===t||!t.hasOwnProperty("fn"))throw new Error("CropImage requires jQuery");t.fn.cropimage=function(o,a){var n,s=t.extend({image:!1,imgFormat:"auto",device:"all",circleCrop:!1,zoomable:!0,zoomMax:2,outBoundColor:"black",btnDoneAttr:".R-container .R-btn-done"},o);t(this).html((d=s,'<div class="R-container"><div class="R-cover"></div><div class="R-adapter"><canvas class="statCanvas"></canvas><div class="R-cropper'+(d.circleCrop?" circle":"")+'"><canvas class="dynaCanvas"></canvas><div class="R-col-1"></div><div class="R-col-2"></div><div class="R-col-3"></div><div class="R-raw-1"></div><div class="R-raw-2"></div><div class="R-raw-3"></div><div class="R-corner-lt" data-action="lt-crop"></div><div class="R-corner-rt" data-action="rt-crop"></div><div class="R-corner-rb" data-action="rb-crop"></div><div class="R-corner-lb" data-action="lb-crop"></div><div class="R-side-left" data-action="l-crop"></div><div class="R-side-top" data-action="t-crop"></div><div class="R-side-right" data-action="r-crop"></div><div class="R-side-bottom" data-action="b-crop"></div></div></div></div>'));var d;var r=new Image,g=(t(this),t(".R-container")),c=t(".R-adapter"),p=t(".R-cropper"),l=t(".R-cover"),w=t('[class^="R-side-"], [class^="R-corner-"]');s.image?n="string"!=typeof s.image?window.URL.createObjectURL(s.image):s.image:g.html('<div class="R-error">Configuration Error: Set the image URL or blob image file as options.image </div>');r.onload=function(){!function(i,o,a){var n,s={width:80,height:80};/x/.test(o.imgFormat)?(n=o.imgFormat.split("x"),s.width=Number(n[0]),s.height=Number(n[1]),e=!0,h=!1,!1,t(".R-container [data-action]").hide()):/[1-9]\/[1-9]/.test(o.imgFormat)?(n=o.imgFormat.split("/"),s.width*=Number(n[0]),s.height*=Number(n[1]),e=!1,h=!0,!1,t(".R-container [data-action]").show(),t(".R-container [class^=R-side-]").hide()):(e=!1,h=!1,!0,t(".R-container [data-action]").show());i.width>=s.width&&i.height>=s.height?a({width:i.width,height:i.height,minWidth:s.width,minHeight:s.height,ratio:Number(s.width)/Number(s.height)}):t(".R-container").html('<div class="R-error">This image is smaller than '+s.width+"x"+s.height+"</div>")}(r,s,(function(o){var n=document.querySelector(".statCanvas"),d=document.querySelector(".dynaCanvas"),m=n.getContext("2d"),f=d.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",n.width=g.width(),n.height=g.height(),function(t,i,e){var h=t.width,o=t.height,a=t.width>=t.height,n=0,s=0;a&&t.width>i.width()?(o*=i.width()/h,h=i.width(),n=(i.height()-o)/2):(h*=i.height()/o,o=i.height(),s=(i.width()-h)/2);e({width:h,height:o,left:s,top:n,HzImage:t.width!=t.height?t.width>t.height:null})}(o,g,(function(g){l.css({left:g.left+"px",top:g.top+"px",right:g.left+"px",bottom:g.top+"px",background:i[i.hasOwnProperty(s.outBoundColor)?s.outBoundColor:"black"]}),function(t,i,e){var h,o,a=i.width,n=i.height;1!=t.ratio?t.ratio<1?(h=a<n?a/n>t.minWidth/t.minHeight?t.minWidth*n/t.minHeight:a:t.minWidth<t.minHeight?t.minWidth*n/t.minHeight:a,o=a<n?a/n>t.minWidth/t.minHeight?n:t.minHeight*a/t.minWidth:t.minWidth<t.minHeight?n:a*(t.minHeight/n)):(h=a<n?a:a/n>t.minWidth/t.minHeight?t.minWidth*n/t.minHeight:a,o=a<n?t.minHeight*a/t.minWidth:a/n>t.minWidth/t.minHeight?n:a*(t.minHeight/n)):h=o=a<n?a:n;e({width:h,height:o,left:i.HzImage?(a-h)/2:0,top:i.HzImage?0:(n-o)/2})}(o,g,(function(i){p.css({width:d.width=i.width-4,height:d.height=i.height-4,left:i.left+"px",top:i.top+"px"});var u=g.width-d.width,v=g.height-d.height,x=0+g.width,b=0+g.height,R=p.width()/2,I=p.height()/2,z=!1,y={width:g.width,height:g.height,left:0,top:0},H={},k={},C=!0,W=0,E=1;function X(t,i,e){var h=(e?t.originalEvent.touches[0].clientX:t.pageX)-i.x,o=(e?t.originalEvent.touches[0].clientY:t.pageY)-i.y,a=o>=0&&o<=v-4;h>=0&&h<=u-4?p.css("left",h+"px"):h=p.position().left,a?p.css("top",o+"px"):o=p.position().top,E>1&&(m.clearRect(0,0,y.width,y.height),i.ox=Math.floor(t.pageX-l.offset().left),i.oy=Math.floor(t.pageY-l.offset().top),m.drawImage(r,-i.ox*W,-i.oy*W,y.width,y.height)),f.drawImage(n,h+2,o+2,p.width(),p.height(),0,0,p.width(),p.height())}function Y(t,i,e){var a,s,r=(e?t.originalEvent.touches[0].pageX:t.pageX)-p.offset().left,l=(e?t.originalEvent.touches[0].pageY:t.pageY)-p.offset().top,w=(e?t.originalEvent.touches[0].clientX:t.clientX)-c.offset().left,m=(e?t.originalEvent.touches[0].clientY:t.clientY)-c.offset().top;switch(i.t.data("action")){case"l-crop":a=p.width()-r,0<=w&&a>R&&(p.css({width:a+"px",left:w+"px"}),d.width=a,f.drawImage(n,w+2,p.position().top+2,a,p.height(),0,0,a,p.height()));break;case"r-crop":a=r,x-4>=w&&a>R&&(p.css("width",a+"px"),d.width=a,f.drawImage(n,p.position().left+2,p.position().top+2,a,p.height(),0,0,a,p.height()));break;case"t-crop":s=p.height()-l,0<=m&&s>I&&(p.css({height:s+"px",top:m+"px"}),d.height=s,f.drawImage(n,p.position().left+2,m,p.width()+2,s,0,0,p.width(),s));break;case"b-crop":s=l,b-4>=m&&s>I&&(p.css("height",s+"px"),d.height=s,f.drawImage(n,p.position().left+2,p.position().top+2,p.width(),s,0,0,p.width(),s));break;case"lt-crop":a=p.width()-r,s=p.height()-l,h?0<=w&&a>R&&(s=a/o.ratio,0<=(m=i.topHeight-s)&&m<=g.height-s-4&&s>I&&(p.css({width:a+"px",height:s+"px",left:w+"px",top:m+"px"}),d.width=a,d.height=s,f.drawImage(n,w+2,m+2,a,s,0,0,a,s))):(0<=w&&a>R&&(p.css({width:a+"px",left:w+"px"}),d.width=a,f.drawImage(n,w+2,p.position().top+2,a,p.height(),0,0,a,p.height())),0<=m&&s>I&&(p.css({height:s+"px",top:m+"px"}),d.height=s,f.drawImage(n,p.position().left+2,m+2,p.width(),s,0,0,p.width(),s)));break;case"lb-crop":a=p.width()-r,s=l,h?0<=w&&a>R&&(s=a/o.ratio,b-4>=m&&s>I&&s<g.height-p.position().top-4&&(p.css({width:a+"px",height:s+"px",left:w+"px"}),d.width=a,d.height=s,f.drawImage(n,w+2,p.position().top+2,a,s,0,0,a,s))):(0<=w&&a>R&&(p.css({width:a+"px",left:w+"px"}),d.width=a,f.drawImage(n,w+2,p.position().top+2,a,p.height(),0,0,a,p.height())),b-4>=m&&s>I&&(p.css("height",s+"px"),d.height=s,f.drawImage(n,p.position().left+2,p.position().top+2,p.width(),s,0,0,p.width(),s)));break;case"rt-crop":a=r,s=p.height()-l,h?x-4>=w&&a>R&&(s=a/o.ratio,0<=(m=i.topHeight-s)&&s>I&&(p.css({width:a+"px",height:s+"px",top:m+"px"}),d.width=a,d.height=s,f.drawImage(n,p.position().left+2,m+2,a,s,0,0,a,s)),i.lastLeft=w):(x-4>=w&&a>R&&(p.css("width",a+"px"),d.width=a,f.drawImage(n,p.position().left+2,p.position().top+2,a,p.height(),0,0,a,p.height())),0<=m&&s>I&&(p.css({height:s+"px",top:m+"px"}),d.height=s,f.drawImage(n,p.position().left+2,m+2,p.width(),s,0,0,p.width(),s)));break;case"rb-crop":a=r,s=l,h?x-4>=w&&a>R&&(s=a/o.ratio,b-4>=m&&s>I&&s<g.height-p.position().top-4&&(p.css({width:a+"px",height:s+"px"}),d.width=a,d.height=s,f.drawImage(n,p.position().left+2,p.position().top+2,a,s,0,0,a,s))):(x-4>=w&&a>R&&(p.css("width",a+"px"),d.width=a,f.drawImage(n,p.position().left+2,p.position().top+2,a,p.height(),0,0,a,p.height())),b-4>=m&&s>I&&(p.css("height",s+"px"),d.height=s,f.drawImage(n,p.position().left+2,p.position().top+2,p.width(),s,0,0,p.width(),s)))}}function j(){z=!1,H={},k={}}m.drawImage(r,0,0,g.width,g.height),c.css({left:g.left,top:g.top,width:g.width,height:g.height}),f.drawImage(n,i.left+2,i.top+2,i.width,i.height,0,0,i.width,i.height),p.mousedown((function(t){z||(H.t=p,H.x=t.pageX-p.position().left,H.y=t.pageY-p.position().top),u=g.width-p.width(),v=g.height-p.height()})).dblclick((function(t){s.zoomable&&(1==E&&(C=!0),E>s.zoomMax-.5&&(C=!1),H.ox=Math.floor(t.pageX-l.offset().left),H.oy=Math.floor(t.pageY-l.offset().top),function(t){m.clearRect(0,0,y.width,y.height),t&&E<s.zoomMax?E++:E>1&&E--;y.width=g.width*E,y.height=g.height*E,W=E-(E>1?E/2:0),y.left=E>1?-H.ox*W:0,y.top=E>1?-H.oy*W:0,m.drawImage(r,y.left,y.top,y.width,y.height),f.drawImage(n,p.position().left+2,p.position().top+2,p.width(),p.height(),0,0,p.width(),p.height())}(C))})).touchstart((function(t){z||(H.t=p,H.x=t.originalEvent.touches[0].clientX-p.position().left,H.y=t.originalEvent.touches[0].clientY-p.position().top),u=g.width-p.width(),v=g.height-p.height()})),w.mousedown((function(i){z=!0,k.t=t(this),k.topHeight=p.position().top+p.height()})),t(document).mouseup((function(){j()})).mousemove((function(t){t.preventDefault(),!e&&k.t&&Y(t,k)})).touchend((function(){j()})),c.mousemove((function(t){t.preventDefault(),H.t&&X(t,H)})).touchmove((function(t){t.preventDefault(),H.t?X(t,H,!0):k.t&&(k.x||k.y)&&Y(t,k,!0)})),t(s.btnDoneAttr).click((function(){a(d.toDataURL("image/jpeg"))}))}))}))}))},r.src=n},t.fn.extend({touchend:function(t){return t?this.bind("touchend",t):this.trigger("touchend")},touchstart:function(t){return t?this.bind("touchstart",t):this.trigger("touchstart")},touchmove:function(t){return t?this.bind("touchmove",t):this.trigger("touchmove")}})}));